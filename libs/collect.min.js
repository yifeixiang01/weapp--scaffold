module.exports=function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o={},r=function(){const e={},t=wx.getLaunchOptionsSync&&wx.getLaunchOptionsSync()||{};return e.app_id=wx.getAccountInfoSync&&wx.getAccountInfoSync().miniProgram&&wx.getAccountInfoSync().miniProgram.appId||"",e.scene=t&&t.scene||"unknow",e.union_id="unknow",e.app_type=1,e.user_agent="unknow",e}();function a(){const e=wx.getStorageSync("rand_device_id");e?o.device_id=e:(o.device_id="rand-"+(new Date).getTime()+"-"+Math.random().toString().substr(2,5),wx.setStorageSync("rand_device_id",o.device_id))}wx.getSystemInfo({success:function(e){o.brand=e.brand,o.model=e.model,o.channel_id=e.channel_id||"",o.device_type=e.device_type||"",o.screen_width=Number(e.screenWidth),o.screen_height=Number(e.screenHeight),o.os=e.system.split(" ")[0],o.os_version=e.system.split(" ")[1],r.wx_version=e.version}}),wx.getNetworkType({success:function(e){o.network_type=e.networkType}}),wx.onNetworkStatusChange((function(e){o.network_type=e.networkType})),void 0!==wx.getVechicleId?wx.getVechicleId({success:function(e){e.vechicleId?o.device_id=e.vechicleId:a()},fail:function(e){a(),console.log(e)}}):a();o.user_id=wx.getStorageSync("user_id"),o.session_id="s"+(1e4*Math.random()>>0)+Date.now(),t.infobase=r,t.device_info=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.options=t.getConfig=t.postData=void 0;var o=n(0);const r={};let a=null,i=0;const s=function(){return new Promise((function(e,t){i-1e4<Date.now()?wx.request({url:r.apiUrl+"/daq/v2/authorization",method:"post",data:{vin:o.device_info.device_id,app_key:r.appKey,app_secret:r.appSecret},success(n){const o=n.data;"0000"===o.code?(a=o.data.token,i=o.data.expires_in,e(a)):t(n)},fail(e){t(e)}}):e(a)}))};t.postData=function(e){return new Promise((function(t,n){s().then(o=>{wx.request({url:r.apiUrl+"/daq/v2/log/collect",data:e,method:"POST",header:{Authorization:"Bearer "+o},success(e){t()},fail(e){n(e)}})}).catch((function(e){n(e)}))}))},t.getConfig=function(){return new Promise((function(e,t){s().then(n=>{wx.request({url:r.apiUrl+"/daq/v2/log/config",data:{channel_id:r.channelId,data:[{app_key:r.appKey,app_version:r.appVersion}]},method:"POST",header:{Authorization:"Bearer "+n},success(n){n&&n.data&&"0000"===n.data.code?e(n.data.data[0]):t(n)},fail(e){t(e)}})}).catch((function(e){t(e)}))}))},t.options=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o={x:-1,y:-1};t.getBoundingClientRect=function(e){const t=this;return new Promise(n=>{const o=t.createSelectorQuery();o.selectAll(e).boundingClientRect(),o.selectViewport().scrollOffset(),o.exec(e=>{n({boundingClientRect:e[0],scrollOffset:e[1]})})})},t.isClickTrackArea=function(e,t,n){if(!t)return!1;const{x:r,y:a}=e.detail;o.x=r,o.y=a;const{left:i,right:s,top:c,height:d}=t,p=n&&n.scrollTop||0;return i<r&&r<s&&p+c<a&&a<p+c+d},t.getActivePage=function(){const e=getCurrentPages();return e.length?e[e.length-1]:{}},t.getPrevPage=function(){const e=getCurrentPages();return e.length>1?e[e.length-2]:{}},t._isPromise=function(e){return e&&"[object Promise]"===Object.prototype.toString.call(e)},t.clickPos=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.sendMta=t.reportError=t.reportInteraction=t.report=t.reportConfig=void 0;var o=n(0),r=n(1),a=n(2),i=n(7);let s="",c=!1,d=t.reportConfig={};const p=function(){(0,r.getConfig)().then(e=>{t.reportConfig=d=e||{channel:1,collect_way:2,strategy:1,interval:2e3},1===d.strategy?t.sendMta=P=w(P,d.interval<2e3?2e3:d.interval):t.sendMta=P=w(P,2e3),c=!0,0!==d.channel&&1!==d.collect_way&&(c&&0!==d.strategy||h.length+u.length>d.interval)&&P()}).catch((function(){setTimeout((function(){p()}),6e5)}))};let l=null,h=[],u=[];const g=[];let f=[],_=[],y=[],m=[],v=[];function w(e,t){let n=!1;return function(){const o=this,r=arguments;n||(n=!0,setTimeout((function(){n=!1,e.apply(o,r)}),t))}}let P=function(){null===l&&(l=JSON.parse(JSON.stringify(o.device_info)),l.data=[],l.data.push(JSON.parse(JSON.stringify(o.infobase)))),l.timestamp=Date.now(),l.user_id=wx.getStorageSync("user_id"),l.data[0].appkey=r.options.appKey,l.data[0].channel_id=o.device_info.device_type,l.data[0].events=h,l.data[0].fragment=f,l.data[0].interaction=u,l.data[0].activity=[];for(let e=g.length-1;e>=0;e--)g[e]&&g[e].end_time&&(l.data[0].activity.push(g[e]),g.splice(e,1));if(h=[],f=[],u=[],l.data[0].interaction=l.data[0].interaction.concat(y),l.data[0].fragment=l.data[0].fragment.concat(v),l.data[0].events=l.data[0].events.concat(_),l.data[0].activity=l.data[0].activity.concat(m),_=[],y=[],m=[],v=[],r.options.isShowLog){console.log("上报:"+JSON.stringify(l));const e=l.data[0].events;for(let t=0;t<e.length;t++)console.log("事件:"+JSON.stringify(e[t]))}(0,r.postData)(l).catch((function(){console.log("上报失败"),_=l.data[0].events,y=l.data[0].interaction,m=l.data[0].activity,v=l.data[0].fragment}))};t.report=function(e,t,n){if(0===d.channel||1===d.collect_way)return;const{element:o,method:r}=e,a=function(e,t,n,o,r){let a;return e.cache?a=e.cache:(a=e.injectData||{},t&&(a.event_label=t,a.event_id=a.event_id||t),n&&(a.event_label=n,a.event_id=a.event_id||n),a.properties=a.properties||{},e.cache=a),a.event_time=Date.now(),e.dataKeys&&e.dataKeys.forEach(t=>{const n=(0,i.dataReader)(t,e.dataset,o,r),s=t.split(".");0==(t=s[s.length-1]).indexOf("$")&&(t=t.substr(1)),a.properties[t]=n}),a}(e,r,o,t,n);h.push(a);const p=getCurrentPages();if(p.length>0){const e=p[p.length-1].route;if(a.properties._page_url_name=e,r&&"onShow"===r)g.push({start_time:a.event_time,page_name:e,page_from:s}),s=e;else if(r&&"onHide"===r||"onUnload"===r){const t=g.length;void 0!==g[t-1]&&(g[t-1].end_time=a.event_time),"appHide"===a.event_id&&void 0!==g[0]&&(g[0].end_time=a.event_time,g[0].page_from=e)}}else"appShow"===a.event_id&&g.push({start_time:a.event_time,page_name:"app"});(c&&0!==d.strategy||h.length+u.length>d.interval)&&P()},t.reportInteraction=function(e){if(0===d.channel||0!==d.collect_way)return;const t={event_time:Date.now(),page:(0,a.getActivePage)().route,entry_name:s,duration:0,method:e.type,method_name:"unkown",text:"unkown",properties:{target:e.target,detail:e.detail}};u.push(t),c&&(0!==d.strategy||h.length+u.length>d.interval)&&P()},t.reportError=function(e){r.options.isShowLog&&(console.log(e.event_id+"_"+e.event_label),console.log(e)),e.event_time=Date.now(),h.push(e),c&&P()},t.sendMta=P,t.init=p},function(e,t,n){e.exports=n(5)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),r=n(2),a=n(3),i=n(1),s=n(0);console.log("collect 1.2.6");class c extends o.Wrapper{constructor({tracks:e,version:t,app_id:n,is0000error:o=!0,apiUrl:r,appKey:c,appSecret:d,channelId:p,appVersion:l,data_type:h,isShowLog:u}){s.device_info.data_type=h,n&&(s.infobase.app_id=n),s.infobase.miniprogram_version=t,i.options.appKey=c,i.options.apiUrl=r,i.options.appSecret=d,i.options.channelId=p,i.options.appVersion=l,i.options.isShowLog=u,setTimeout(a.init,5e3),super(),this.tracks=e,this.addPageMethodExtra(this.elementTracker()),this.addPageMethodWrapper(this.methodTracker()),this.addComMethodExtra(this.elementTracker()),this.addComMethodWrapper(this.methodTrackerCom()),this.addAppMethodWrapper(this.appTracker())}appTracker(){const e=this;return(t,n)=>{((e.tracks.find(e=>"app"===e.path.toLocaleLowerCase())||{}).methodTracks||[]).forEach(e=>{e.method===n&&(0,a.report)(e)})}}elementTracker(){const e=this,t=function(t){if(1!==a.reportConfig.collect_way)try{(0,a.reportInteraction)(t);const n=e.findActivePageTracks("element");let{data:o}=(0,r.getActivePage)();n.forEach(e=>{r.getBoundingClientRect.call(this,e.element).then(n=>{n.boundingClientRect.forEach(i=>{const s=(0,r.isClickTrackArea)(t,i,n.scrollOffset);e.dataset=i.dataset,o!==this.data&&(o=Object.assign({},o,this.data)),s&&(0,a.report)(e,o)})})})}catch(t){console.error(t),i.options.isShowLog&&console.log(t.stack),(0,a.reportError)({event_id:"_codeError",event_label:"elementTracker",properties:{activePage:(0,r.getActivePage)().route,pageData:(0,r.getActivePage)().data,error:t.stack.slice(0,500)}})}};return t.fnname="elementTracker",t}methodTracker(){return(e,t)=>{this.findActivePageTracks("method").forEach(n=>{n.method===t&&(0,a.report)(n,e.data)})}}methodTrackerCom(){return(e,t)=>{const n=this.findActivePageTracks("method"),{data:o}=(0,r.getActivePage)();n.forEach(n=>{n.method===t&&(0,a.report)(n,o,e.data)})}}findActivePageTracks(e){try{const{route:t}=(0,r.getActivePage)(),n=this.tracks.find(e=>e.path===t)||{};let o={};return"method"===e?o=n.methodTracks||[]:"element"===e&&(o=n.elementTracks||[]),o}catch(e){return{}}}}t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Wrapper=void 0;var o=n(3),r=n(2),a=n(1);const i=App,s=Page,c=Component;t.Wrapper=class{constructor(){this.injectPageMethods=[],this.injectAppMethods=[],this.injectComMethods=[],this.extraComMethods=[],this.extraPageMethods=[],this.extraAppMethods=[],App=e=>i(this._create(e,this.injectAppMethods,this.extraAppMethods)),Page=e=>s(this._create(e,this.injectPageMethods,this.extraPageMethods)),Component=e=>c(this._createCom(e,this.injectComMethods,this.extraComMethods))}___wrapTargetMethod(e,t,n,i){return function(...s){let c;e=this;try{c=i&&i.apply(this,s)}catch(n){console.error(n),a.options.isShowLog&&console.log(n.stack),(0,o.reportError)({event_id:"_codeError",event_label:t,properties:{activePage:(0,r.getActivePage)().route,pageData:e.data,args:s,error:n.stack.slice(0,500)}})}if(1===o.reportConfig.collect_way)return c;const d=()=>{try{n.forEach(n=>{n.apply(this,[e,t,...s])})}catch(n){console.error(n),a.options.isShowLog&&console.log("钩子函数执行出现错误"+n.stack),(0,o.reportError)({event_id:"_codeError",event_label:t,properties:{activePage:(0,r.getActivePage)().route,pageData:e.data,error:n.stack.slice(0,500),maybe:"埋点上报配置文件有问题"}})}};return"[object Promise]"===Object.prototype.toString.call(c)?c.then(()=>{d()}).catch(n=>{"[object Error]"===Object.prototype.toString.call(n)&&(console.error(n),a.options.isShowLog&&console.log(n.stack),(0,o.reportError)({event_id:"_codeError",event_label:t,properties:{activePage:(0,r.getActivePage)().route,pageData:e.data,error:n.stack.slice(0,500),maybe:""}})),d()}):d(),c}}_wrapTargetMethod(e,t,n=[]){const o=e[t];e[t]=this.___wrapTargetMethod(e,t,n,o)}_wrapTargetMethodCom(e,t,n=[]){const o=e.methods[t];e.methods[t]=this.___wrapTargetMethod(e,t,n,o)}_addExtraMethod(e,t){t.forEach(t=>{const n=t.fnname;e.hasOwnProperty("methods")?e.methods[n]=t:e[n]=t})}_create(e,t,n){return e.hasOwnProperty("onLoad")||(e.onLoad=()=>{}),e.hasOwnProperty("onHide")||(e.onHide=()=>{}),e.hasOwnProperty("onShow")||(e.onShow=()=>{}),e.hasOwnProperty("onReady")||(e.onReady=()=>{}),e.hasOwnProperty("onUnload")||(e.onUnload=()=>{}),Object.keys(e).filter(t=>"function"==typeof e[t]).forEach(n=>{this._wrapTargetMethod(e,n,t)}),this._addExtraMethod(e,n),e}_createCom(e,t,n){return e.methods&&Object.keys(e.methods).filter(t=>"function"==typeof e.methods[t]).forEach(n=>{this._wrapTargetMethodCom(e,n,t)}),e.hasOwnProperty("attached")||(e.attached=()=>{}),e.hasOwnProperty("ready")||(e.ready=()=>{}),e.hasOwnProperty("detached")||(e.detached=()=>{}),e.hasOwnProperty("created")||(e.created=()=>{}),Object.keys(e).filter(t=>"function"==typeof e[t]).forEach(n=>{this._wrapTargetMethod(e,n,t)}),this._addExtraMethod(e,n),e}addAppMethodWrapper(e){this.injectAppMethods.push(e)}addAppMethodExtra(e){this.extraAppMethods.push(e)}addPageMethodWrapper(e){this.injectPageMethods.push(e)}addPageMethodExtra(e){this.extraPageMethods.push(e)}addComMethodWrapper(e){this.injectComMethods.push(e)}addComMethodExtra(e){this.extraComMethods.push(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=(e,t)=>{const n=e.indexOf("["),o=e.indexOf("]"),r={};if(n>-1){let a=e.substring(n+1,o);const i=e.substring(0,n);"$INDEX"===a&&(a=t),r.key=i,r.index=parseInt(a,10)}return r};t.dataReader=(e,t,n,r)=>{let a="";return a=0===e.indexOf("$")?((e,t)=>{let n="";if(0===e.indexOf("$APP.")){const t=getApp();if(!t)return"";const o=e.split("$APP.")[1].split(".");n=1===o.length?t[o[0]]:2===o.length?t[o[0]][o[1]]:t[o[0]][o[1]][o[2]]}else if(0===e.indexOf("$DATASET.")){n=t[e.split("$DATASET.")[1]]}else if(0===e.indexOf("$INDEX"))n=t[index];else if(0===e.indexOf("$STORAGE")){const t=e.split("$STORAGE.")[1];n=wx.getStorageSync(t)}return n})(e,t):((e,t={},n,r)=>{if(void 0===n)return"";const{index:a}=t,i=e.split(".");let s;if(2===i.length){let e=o(i[0],a);e.key&&void 0!==e.index?(s=r&&r.hasOwnProperty(e.key)?r[e.key][e.index]:n[e.key][e.index],e=o(i[1],a),s=e.key?s[e.key][e.index]:s[i[1]]):(s=r&&r.hasOwnProperty(i[0])?r[i[0]]:n[i[0]],e=o(i[1],a),s=e.key?s[e.key][e.index]:s[i[1]])}else{const e=o(i[0],a);s=e.key&&void 0!==e.index?r&&r.hasOwnProperty(e.key)?r[e.key][e.index]:n[e.key][e.index]:r&&r.hasOwnProperty(i[0])?r[i[0]]:n[i[0]]}return s})(e,t,n,r),a}}]);